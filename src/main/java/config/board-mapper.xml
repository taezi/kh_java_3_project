<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.boardMapper">
  <select id="AllBoard" resultType="dto.boardDTO">
    select * from
    (select
    row_number() over(order by b.bno desc) as rw, b.*
	from board_view b)
	where ceil(rw / #{pageContentEa}) = #{pageNo}
  </select>
  
  <select id="SelectBoardTotalCount" resultType="int">
	select count(*) from board_view
  </select>
  
  	<select id="selectBoardNo" resultType="int">
		select seq_board_bno.nextval from dual
	</select>
	
	<insert id="insertBoard">
	  insert into board_view(bno, usersid, titles, bpost)
	  values(#{bno}, #{usersId}, #{titles}, #{bpost})
	</insert>
  
  <update id="UpdateBoardCount">
  	  update board set bview = bview + 1
	  where bno = #{bno}
  </update>
  
  <select id="BoardView" resultType="dto.boardDTO">
	select * from board where bno = #{bno}
  </select>
  
  <select id="BoardCommentView" resultType="dto.boardCommentDTO">
  	<![CDATA[
  			select * from
			(select row_number() over(order by bcno desc) as rw, bc.* 
			from board_comment bc where bno = #{bno})
			where rw <= #{page} * 5 
		]]>
  </select>
  
  <insert id="InsertBoardLike">
  	insert into board_event(bno, usersId) values(#{bno},#{usersId})
  </insert>
  
  <delete id="DeleteBoardLike">
  	delete from board_event where bno = #{bno} and usersId = #{usersId}
  </delete>
  
  <select id="SelectBoardLikeHateCount" resultType="map">
		select
		(select count(*) from board_view where bno = #{bno}) as blike,
		(select count(*) from board_view where bno = #{bno}) as bhate
		from dual
	</select>
</mapper>